/* INSERÇÃO AUTOMÁTICA DE PLANOS BASEADO NOS PLANOS BASE - PLAXSET PENDENBTES */
/* BEETHOVEN SANTOS NUNES                                */
DECLARE @FILIAL AS VARCHAR(5)

SELECT DISTINCT ' INSERT INTO ENGEMAN.PLAXSET (ATIVO,CODEMP,CODPLA,CODSET,EXEDIA,HOREXEPRE, HORPRE, NIVREC) VALUES (''S'',1'
                +','+CAST(PLAMANUT.CODPLA AS VARCHAR)
                +','+CAST(SETBASE.CODSET AS VARCHAR)
                +','+CAST(SETBASE.EXEDIA AS VARCHAR)
                +','+CAST(SETBASE.HOREXEPRE AS VARCHAR)
                +','''+CAST(SETBASE.HORPRE AS CHAR(5))+''''
                +',''C'')' + '--'+PLAMANUT.TAG 
                +CHAR(13)+'!' 
                AS '/*INSERT*/' 
 
FROM ENGEMAN.PLAMANUT
INNER JOIN ENGEMAN.PLAMANUT PLANOBASE ON 2=2 AND PLANOBASE.TAG LIKE 'xxx'
INNER JOIN ENGEMAN.PLAXSET SETBASE ON 3=3 AND SETBASE.CODPLA=PLANOBASE.CODPLA
 
WHERE SUBSTRING(PLAMANUT.TAG,4,LEN(PLAMANUT.TAG))=SUBSTRING(PLANOBASE.TAG,4,LEN(PLANOBASE.TAG))
AND PLAMANUT.CODPLA NOT IN (SELECT CODPLA FROM PLAXSET)
--AND SUBSTRING(PLAMANUT.TAG,0,4)  IN ('CGR','COC','POL','MVE','NIA','SGO','VAE','VGA','ARV','PLA','AIR','GOE')
