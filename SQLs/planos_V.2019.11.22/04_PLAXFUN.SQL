/* INSER«√O AUTOM√ÅTICA DE PLANOS BASEADO NOS PLANOS BASE, PASSANDO COMO PARAMETO A FILIAL OU PLANO DE MANUTEN«√O BASE  */
/* BEETHOVEN SANTOS NUNES                                */

 SELECT ' INSERT INTO ENGEMAN.PLAXFUN (CODEMP,CODCAR,CODPLA,CODPLAXSET,CODSET,HORAS,ORDEM,QTDEFUN) VALUES (1'
                +','+CAST(FUNBASE.CODCAR AS VARCHAR)
                +','+CAST(PLAMANUT.CODPLA AS VARCHAR)
                +','+CAST(PLAXSET.CODPLAXSET AS VARCHAR)
                +','+CAST(FUNBASE.CODSET AS VARCHAR)
                +','+CAST(FUNBASE.HORAS AS VARCHAR)
                +','+CAST(FUNBASE.ORDEM AS VARCHAR)
                +','+CAST(FUNBASE.QTDEFUN AS VARCHAR)
                +')'+ '--'+PLAMANUT.TAG 
                +CHAR(13)+'!'
                AS '/*INSERT*/'

FROM ENGEMAN.PLAMANUT
  INNER JOIN ENGEMAN.PLAMANUT PLANOBASE ON PLANOBASE.TAG LIKE 'XXX'
  INNER JOIN ENGEMAN.PLAXSET SETBASE ON SETBASE.CODPLA=PLANOBASE.CODPLA
  INNER JOIN ENGEMAN.PLAXFUN FUNBASE ON FUNBASE.CODPLA=PLANOBASE.CODPLA  
  INNER JOIN ENGEMAN.PLAXSET ON PLAXSET.CODPLA=PLAMANUT.CODPLA
WHERE SUBSTRING(PLAMANUT.TAG,4,LEN(PLAMANUT.TAG))=SUBSTRING(PLANOBASE.TAG,4,LEN(PLANOBASE.TAG))
  
  AND PLAMANUT.CODPLA NOT IN (SELECT CODPLA FROM PLAXFUN)
ORDER BY PLAMANUT.TAG